var u=Object.assign;var d=(c,i,e)=>new Promise((l,r)=>{var a=s=>{try{o(e.next(s))}catch(y){r(y)}},t=s=>{try{o(e.throw(s))}catch(y){r(y)}},o=s=>s.done?l(s.value):Promise.resolve(s.value).then(a,t);o((e=e.apply(c,i)).next())});import m from"querystring-number";var f={},h=(l,r,...a)=>d(void 0,[l,r,...a],function*(c,i,e={}){let t;t=i&&JSON.stringify(i);let o=(e.baseUrl||"")+c,s=o+t;if(e.cacheTime){let n=f[s];if(n&&Date.now()-n.time<e.cacheTime)return n}let y=Object.prototype.toString.call(i)==="[object FormData]";return e.headers||(e.headers={}),e.headers["Content-Type"]||(y?e.headers["Content-Type"]="application/x-www-form-urlencoded":e.headers["Content-Type"]="application/json"),e.method==="GET"&&!e.headers["Cache-Control"]&&(e.headers["Cache-Control"]="public, max-age=604800, immutable"),fetch(o,u(u({body:t},e),{headers:e.headers})).then(n=>d(void 0,null,function*(){return{body:yield n[e.format||"json"](),status:n.status,headers:n.headers}})).then(n=>d(void 0,null,function*(){return e.cacheTime&&(f[s]={data:n,time:Date.now()}),e.reduce&&(n=yield Promise.resolve(e.reduce(n))),e.onSuccess&&(yield Promise.resolve(e.onSuccess(n))),n})).catch(n=>d(void 0,null,function*(){e.onError&&(yield Promise.resolve(e.onError(n)))}))}),T=(c,i,e,l,r,a)=>d(void 0,null,function*(){if(typeof window=="undefined")return;let t="/"+i;return e&&(t+="?"+m.stringify(e)),h(t,l,u(u(u({},r),a),{method:c}))}),b={get:!0,post:!0,put:!0,del:!0,options:!0},w=(c={})=>{let i=e=>new Proxy(e,{get(r,a){if(!r[a])if(!b[a])r[a]=i({___parent:r.___parent?r.___parent+"/"+a:a});else{let t=a.toUpperCase();t==="DEL"&&(t="DELETE");let o=r.___parent;r[a]=({query:s,body:y,options:n}={})=>T(t,o,s,y,c,n)}return r[a]}});return i({})};export{h as baseApi,w as createFetily};
